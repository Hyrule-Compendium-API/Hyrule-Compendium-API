# Execute API tests in tests/

name: API Tests

on: push

jobs:
  main:
      runs-on: ubuntu-latest
      strategy:
        matrix:
          node-version: [15.x]
          python-version: ["3.9"]
      steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
      - uses: BSFishy/pip-action@v1
        with: 
          requirements: requirements.txt
      - name: Start API server
        run: |
            pip3 list
            python3 server.py ${{ secrets.RS2_TOKEN }} &
      - name: Install dependencies
        run: |
            cd tests
            npm i 
            sudo npm i -g mocha 
            sudo npm i -g ts-node
            sudo npm i typescript
      - name: Execute tests
        run: |
            pwd
            cd tests
            pwd
            env URL="http://127.0.0.1:5000/api/v2" mocha test/index.ts -r ts-node/register